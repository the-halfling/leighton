<!DOCTYPE html>

<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8"/>
  <title>Leighton Shop</title>
  <link rel="stylesheet" href="temp/styles/styles.css">

</head>
<body>

<header>
  <div class="header-nav">
    <div class="header-nav--mobile">
      <a class="header-nav--menu-icon" href="#">
        <img src="../app/assets/images/menu.svg" alt="menu" width="10%">
      </a>
      <img class="header-nav--mobile-logo" src="../app/assets/images/logo.png" alt="the leighton shop" width="50%">
    </div>
    <div class="header-nav--menu-block">
      <ul>
        <li><a href="https://www.leighton.com/work/">Work</a></li>
        <li><a href="https://www.leighton.com/services/">Services</a></li>
        <li><a href="https://www.leighton.com/insights/">Insights</a></li>
        <li><a href="https://www.leighton.com/blog/">Blog</a></li>
        <li><a href="https://www.leighton.com/events/">Events</a></li>
        <li><a href="#"><strong>Shop</strong></a></li>
        <li><a href="https://www.leighton.com/get-in-touch/">Contact</a></li>
      </ul>
    </div>
  </div>
</header>

<div class="featured"></div>
<div class="products"></div>

<script id="template" type="text/template">
    <div class="product">
      <div class="product--header">{{ type }} Product</div>
      <div class="product--image"><img src="../app/assets/images/no-image.jpg" alt="no image"> </div>
      <div class="product--information">
        <div class="product--title">{{ name }}</div>
        <div class="product--brand">Brand: {{ brand }}</div>
        <select>
            <option value="" disabled selected>Select Size</option>
            {{ options }}
        </select>
        <div class="product--description">Description:<br> {{ description }}</div>
        <div class="product--code">Product ID: {{ productid }}</div>
        <button class="btn--buy">Add to basket</button>
        <button class="btn--save">Save for later</button>     
      </div>
    </div
</script>

<script>(() => { 
//set API details
const apiUrl = 'https://27gmrimn45.execute-api.eu-west-2.amazonaws.com/demos/leighton-demo-api?TableName=products';
const headers = new Headers({
  'x-api-key': 'zQo4PPqD862IwDIQRZub8gX4dqjA3aW2DDhI6UF4',
});

const featured = document.querySelector('.featured');
const products = document.querySelector('.products');
const template = document.getElementById('template').innerHTML;
const featuredID = '0m8hjmd721';


const addItem = (item) => {

  const isFeatured = item.productid === featuredID;
  
  //replace the placeholders tempalte
  let html = template.replace('{{ name }}', item.name);
  html = html.replace('{{ brand }}', item.brand);
  html = html.replace('{{ description }}', item.description);
  html = html.replace('{{ productid }}', item.productid);

//loop through all available sizes and create an array
  let options = [];
  ['small', 'medium', 'large'].forEach((size) => {
    if (item.size[size] > 0) {
        options.push(`<option value="${size}">${size} - ${item.size[size]} In Stock</option>`);
    }
  });

  html = html.replace('{{ options }}', options.join(''));
  if (isFeatured) {
    html = html.replace('{{ type }}', 'Featured');
    return featured.innerHTML += html;
  }

  html = html.replace('{{ type }}', '');
  return products.innerHTML += html;

};

fetch(apiUrl, { headers }) 
.then(r => r.json()) 
.then(data => data.Items.forEach(addItem)) 
.catch(error => console.log(error)) 

})(); 

// Script to hide/show menu
var button = document.querySelector('.header-nav--menu-icon');
var menu = document.querySelector('.header-nav--menu-block');
button.addEventListener('click', function (event) {
      if (menu.style.display == "block") {
          menu.style.display = "none";
      } else {
          menu.style.display = "block";
      }
    }
  );
</script>


<footer>
  <div class="footer">
    <div class="footer--copyright">&copy; 2019 the leighton shop</div>
  </div>
</footer>

</body>
</html>