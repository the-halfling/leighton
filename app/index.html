<!DOCTYPE html>

<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8"/>
  <title>Leighton Shop</title>
  <link rel="stylesheet" href="temp/styles/styles.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

</head>
<body>

<header>

  <div class="header-mobile">

    <div class="top-bar" >
      <div class="top-bar--menu">
        <a onclick="toggle_visibility('mobile-nav');" >
          <i class="fas fa-bars"></i>
        </a>
      </div>    
      <div class="top-bar--logo">
        <img  src="../app/assets/images/logo.png" alt="the leighton shop" width="100%">
      </div>
      <div class="top-bar--basket">
        <i class="fas fa-shopping-cart"></i>
      </div>
    </div>

    <div id="mobile-nav" class="mobile-nav" style="display: none;">

      <div class="mobile-filters">
        <div class="mobile-filters__country">
          <img src="../app/assets/images/uk_flag.png" alt="Country Selection - UK">
          <i class="fas fa-caret-down"></i>
        </div>
        <button class="mobile-filters__wishlist" aria-label="View Wishlist"><i class="fas fa-heart"></i></button>
      </div>

      <a onclick="toggle_visibility('mobile-nav__block1');" class="mobile-nav__button closed" title="About Leighton" >
        <div class="nav-button">
          About Leighton
        </div>
      </a>

      <div id="mobile-nav__block1" style="display: none;">  
        <ul>
          <a href="https://www.leighton.com/work/" title="Work"><li>Work</li></a>
          <a href="https://www.leighton.com/services/" title="Services"><li>Services</li></a>
          <a href="https://www.leighton.com/insights/" title="Insights"><li>Insights</li></a>
          <a href="https://www.leighton.com/blog/" title="Blog"><li>Blog</li></a>
          <a href="https://www.leighton.com/events/" title="Events"><li>Events</li></a>
          <a href="#" title="Shop"><li><strong>Shop</strong></li></a>
          <a href="https://www.leighton.com/get-in-touch/" title="Contact"><li>Contact</li></a>
        </ul>
      </div>

      <a onclick="toggle_visibility('mobile-nav__block2');" class="mobile-nav__button closed" title="Leighton Shop">
        <div class="nav-button" aria-label="Leighton Shop">
          Leighton Shop
        </div>
      </a>

      <div id="mobile-nav__block2" style="display: none;">  
        <ul>
          <a href="#" title="Shop Home"><li>Shop Home</li></a>
          <a onclick="toggle_visibility('mobile-nav__sub-block1');" class="mobile-nav__button closed"><li>Male</li></a>
          <div id="mobile-nav__sub-block1" style="display: none;">
            <ul>
              <li>Test Sub Category</li>
            <ul>
          </div>
          <a href="#" title="Female"><li>Female</li></a>
          <a href="#" title="Kids"><li>Kids</li></a>
          <a href="#" title="Sale"><li>Sale</li></a>
          <a href="#" title="Coming Soon"><li>Coming Soon</li></a>
        </ul>
      </div>
      
    </div>

  </div>

  <div class="header-desktop">
    <div class="header-desktop--upper">
      <ul>
          <a href="https://www.leighton.com/work/" title="Work"><li>Work</li></a>
          <a href="https://www.leighton.com/services/" title="Services"><li>Services</li></a>
          <a href="https://www.leighton.com/insights/" title="Insights"><li>Insights</li></a>
          <a href="https://www.leighton.com/blog/" title="Blog"><li>Blog</li></a>
          <a href="https://www.leighton.com/events/" title="Events"><li>Events</li></a>
          <a href="#" title="Shop"><li><strong>Shop</strong></li></a>
          <a href="https://www.leighton.com/get-in-touch/" title="Contact"><li>Contact</li></a>
      </ul>

    </div>

    <div class="header-desktop--mid">
      <div class="header-desktop--mid__container">
        <div class="header-desktop--mid__country">
          <img src="../app/assets/images/uk_flag.png" alt="Country Selection - UK">
          <i class="fas fa-caret-down"></i>
        </div>
      </div>

      <div class="header-desktop--mid__logo">
        <img src="../app/assets/images/logo.png" alt="The Leighton Shop">
      </div>

      <div class="header-desktop--mid__container">
        <div class="header-desktop--mid__basket">
          <span>
            <i class="fas fa-shopping-cart"></i><span class="header-desktop--mid__basket__text"> Your Basket (<span class="red">x</span>)</span>
          </span>
        </div>
      </div>
    </div>
  
    <div class="header-desktop--lower">
      <div class="container">
          <ul>
          <li><a href="#" title="Shop Home">Shop Home</a></li>

          <li>
            <a href="#" class="dropdown" title="Male">Male <i class="fas fa-caret-down"></i></a>
              <ul>
              <li>Test Sub Category</li>
              <li>Test Sub Category 2</li>
              </ul>
          </li>

          <li><a href="#" title="Female">Female <i class="fas fa-caret-down"></i></a></li>
          <li><a href="#" title="Kids">Kids <i class="fas fa-caret-down"></i></a></li>
          <li><a href="#" title="Sale">Sale</a></li>
          <li><a href="#" title="Coming Soon">Coming Soon</a></li>
        </ul>
      </div>
    </div>

  </div>
</header>

<div class="filters">
  <div class="search-box">
    <i class="fas fa-search"></i>
    <input type="text" name="search" id="searchInput">
  </div>

  <div class="page-filters">
    <button class="page-filters__wishlist" aria-label="View Wishlist"><i class="fas fa-heart"></i></button>
    <div class="page-filters__sort">Sort By <i class="fas fa-caret-down"></i></div>
    <div class="page-filters__display">Display <i class="fas fa-caret-down"></i></div>
  </div>
</div>

  <div class="featured product-container"></div>
  <div class="products product-container"></div>

<footer>
  <div class="footer">
    <div class="footer--copyright">&copy; 2019 the leighton shop</div>
  </div>
</footer>

<script id="template" type="text/template">
    <div class="product">
      <div class="product--header">{{ type }}</div>
      <div class="product--image"><img src="../app/assets/images/no-image.png" alt="no image"> </div>
      <div class="product--information">
        <div class="product--title searchable">{{ name }}</div>
        <!--This is just a place holder we would house the prices here if they were on the API -->
        <div class="product--price">Â£55</div>
        <div class="product--brand searchable"><strong>Brand:</strong> {{ brand }}</div>
        <div class="product--colour searchable"><strong>Colour:</strong> {{ colour }}</div>
        <div class="product--sizes">
          <select>
              <option value="" disabled selected>Select Size </option>
              {{ options }}
          </select>
        </div>
        <div class="product--description"><strong>Description:</strong><br><div class="product--description__content searchable">{{ description }}</div></div>
        <div class="product--code searchable"><strong>Product ID:</strong> {{ productid }}</div>
        <div class="product--buttons">
          <button class="btn--buy" aria-label="Add to Basket">Add to basket</button>
          <button class="btn--save" aria-label="Save for Later">Save for later</button>     
        </div>
        <button class="product--add-to-wishlist" aria-label="Add to Wishlist"><i class="fas fa-heart"></i></button>
      </div>
    </div>
</script>

<script>(() => { 
//set API details here
const apiUrl = 'https://27gmrimn45.execute-api.eu-west-2.amazonaws.com/demos/leighton-demo-api?TableName=products';
const headers = new Headers({
  'x-api-key': 'zQo4PPqD862IwDIQRZub8gX4dqjA3aW2DDhI6UF4',
});

//set the templates to for the products and featured products
const featured = document.querySelector('.featured');
const products = document.querySelector('.products');
const template = document.getElementById('template').innerHTML;

//set featured product ID here
const featuredID = '0m8hjmd721';


const addItem = (item) => {

  let hasStock = false;
  //populate the array for sizes 
  let options = [];
  ['small', 'medium', 'large'].forEach((size) => {
    if (item.size[size] > 0) {
         hasStock = true;
         options.push(`<option value="${size}">${size} - ${item.size[size]} In Stock</option>`);
    }
  });
  //skip over products that have no stock
  if (hasStock == false) {
    return;
  };

  //check to see if the product is featured
  const isFeatured = item.productid === featuredID;
  
  //replace the placeholders tempalte
  let html = template.replace(/{{ name }}/g, item.name);
      html = html.replace(/{{ colour }}/g, item.colour);
      html = html.replace(/{{ brand }}/g, item.brand);
      html = html.replace(/{{ description }}/g, item.description);
      html = html.replace(/{{ productid }}/g, item.productid);

  html = html.replace('{{ options }}', options.join(''));
  if (isFeatured) {
    html = html.replace('{{ type }}', 'Featured');
    return featured.innerHTML += html;
  }

  html = html.replace('{{ type }}', '');
  return products.innerHTML += html;

};

//pull the products from the API
fetch(apiUrl, { headers }) 
.then(r => r.json()) 
// add data to the template
.then(data => data.Items.forEach(addItem)) 
//log any errors connecting to the API
.catch(error => console.log(error)) 

})();

// hide/show menu and toggle class on mobile navigation 
//used JQuery to make it easier to deal with multiple menu items 
//to save bloating the code
$('.mobile-nav__button').click(function() {
    $(this).toggleClass('closed');
    $(this).toggleClass('open');
});

    function toggle_visibility(id) {
       var e = document.getElementById(id);
       if(e.style.display == 'block')
          e.style.display = 'none';
       else
          e.style.display = 'block';
    }

// get search element
let searchInput = document.getElementById('searchInput'); 
// add event listener
searchInput.addEventListener('keyup', searchPage);

function searchPage(){
  //set the search value based on the input
  let searchValue = document.getElementById('searchInput').value;

  //set parameters to search from
  let parent = document.getElementsByClassName('product');
  let child = document.getElementsByClassName('searchable');

  //loop through the parent containers
  for (let i = 0; i < parent.length; i++){

    //loop through all child data
    for(let j = 0; j < child.length; j++){
      
      let a = child[j];
      
      if(a.innerText.indexOf(searchValue) > -1) {
    
        parent[i].style.display = '';
        break;

      } else {

        parent[i].style.display = 'none';

      };
    };
  };
};

</script>

</body>
</html>
